---
// Import the Image component
import { Image } from "astro:assets";
import type { ImageMetadata } from "astro";

// Define props from Astro
const { title, subTitle, partners } = Astro.props;

interface Partner {
  icon?: ImageMetadata; // Image metadata from Astro
  svgIcon?: string; // SVG string
  name?: string;
  href?: string;
}

// Define TypeScript interface for props
interface Props {
  title: string;
  subTitle?: string;
  partners?: Partner[];
}
---

<section
  class="mx-auto max-w-[85rem] px-4 py-10 sm:px-6 lg:px-8 lg:py-14 2xl:max-w-full"
>
  <!-- Title and description -->
  <div class="mx-auto mb-6 w-full space-y-1 text-center sm:w-1/2 lg:w-1/3">
    <h2
      class="text-balance text-2xl font-bold leading-tight text-neutral-800 dark:text-neutral-200 sm:text-3xl"
    >
      {title}
    </h2>
    {
      subTitle && (
        <p class="text-pretty leading-tight text-neutral-600 dark:text-neutral-400">
          {subTitle}
        </p>
      )
    }
  </div>
  <!-- Carrusel Container -->
  <div class="overflow-hidden relative max-w-4xl mx-auto">
    <div class="carousel-viewport">
      <div 
        id="carousel-track" 
        class="carousel-track flex items-center gap-16"
      >
      <!-- Múltiples copias para carrusel suave -->
      {partners && partners.length > 0 && (
        <>
          {/* Repetir 6 veces para crear un carrusel realmente infinito */}
          {Array.from({length: 6}, (_, copyIndex) => (
            partners.map((partner, index) => (
              <div 
                class="carousel-item flex-shrink-0 flex items-center justify-center w-40 h-24"
              >
                <a 
                  href={partner.href} 
                  target="_blank" 
                  rel="noopener noreferrer" 
                  class="transition-all duration-300 hover:scale-110 hover:opacity-80 w-full h-full flex items-center justify-center p-2"
                >
                  {partner.svgIcon ? (
                    <div set:html={partner.svgIcon} class="max-w-full max-h-full" />
                  ) : partner.icon ? (
                    <Image
                      src={partner.icon}
                      alt={partner.name || 'Cliente'}
                      class="object-contain max-w-full max-h-full filter brightness-75 hover:brightness-100 transition-all duration-300"
                      width={140}
                      height={90}
                    />
                  ) : null}
                </a>
              </div>
            ))
          ))}
        </>
      )}
      </div>
    </div>
  </div>
</section>

<style>
  .carousel-viewport {
    overflow: hidden;
    width: 100%;
  }

  .carousel-track {
    animation: infinite-scroll 30s linear infinite;
    width: max-content;
  }

  .carousel-track:hover {
    animation-play-state: paused;
  }

  .carousel-item {
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 160px;
    height: 96px;
  }

  .carousel-item:hover {
    animation-play-state: paused;
  }

  @keyframes infinite-scroll {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-16.666%);
    }
  }

  /* Asegurar que no haya saltos visuales */
  .carousel-track * {
    backface-visibility: hidden;
    transform: translateZ(0);
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const carouselTrack = document.getElementById('carousel-track');
    const carouselItems = document.querySelectorAll('.carousel-item');

    if (carouselTrack && carouselItems.length > 0) {
      // Pausar animación al hacer hover sobre cualquier item
      carouselItems.forEach(item => {
        item.addEventListener('mouseenter', () => {
          carouselTrack.style.animationPlayState = 'paused';
        });

        item.addEventListener('mouseleave', () => {
          carouselTrack.style.animationPlayState = 'running';
        });
      });

      // También pausar al hacer hover sobre el track completo
      carouselTrack.addEventListener('mouseenter', () => {
        carouselTrack.style.animationPlayState = 'paused';
      });

      carouselTrack.addEventListener('mouseleave', () => {
        carouselTrack.style.animationPlayState = 'running';
      });
    }
  });
</script>
